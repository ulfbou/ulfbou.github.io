@using MudBlazor
@inherits LayoutComponentBase
@inject AudienceContextService AudienceService
@inject NavigationManager NavManager

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="CustomTheme"/>
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" Class="mud-appbar-fixed-top">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => ToggleNavMenu())" />
        <MudText Typo="Typo.h5" Class="ml-4 cursor-pointer" OnClick="NavigateHome">Ulf's Portfolio</MudText>
        <MudSpacer />
        @* Ensure AudienceService is not null before accessing CurrentAudience *@
        @if (AudienceService != null)
        {
                                                        <MudChip T="string" Color="Color.Primary" Variant="Variant.Filled" Class="mr-4">
                                                            Viewing as: @AudienceService.CurrentAudience
                                                        </MudChip>
        }
        <MudIconButton Icon="@Icons.Material.Filled.LightMode" Color="Color.Inherit" OnClick="@ToggleDarkMode" Class="mr-2" />
        <MudIconButton Icon="@Icons.Custom.Brands.LinkedIn" Color="Color.Inherit" Href="https://www.linkedin.com/in/ulf-bourelius-a9090248/" Target="_blank" />
        <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit" Href="https://github.com/ulfbou" Target="_blank" />
    </MudAppBar>

    <MudDrawer @bind-Open="@_drawerOpen" Elevation="2" Fixed="true" Breakpoint="Breakpoint.Md" Width="280px">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6">Navigation</MudText>
        </MudDrawerHeader>
        <NavMenu />
    </MudDrawer>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Large" Class="mt-8 mb-8 px-4 py-8">
            @Body
        </MudContainer>
    </MudMainContent>

    <footer Class="py-4 mt-auto mud-appbar-fixed-bottom">
        <MudText Typo="Typo.body2" Class="text-center w-full">
            &copy; @DateTime.Now.Year Ulf Bou. Built with Blazor and MudBlazor.
            <MudLink Href="https://www.linkedin.com/in/ulf-bourelius-a9090248//" Target="_blank" Class="mx-2">LinkedIn</MudLink>
            <MudLink Href="https://github.com/ulfbou" Target="_blank" Class="mx-2">GitHub</MudLink>
        </MudText>
    </footer>
</MudLayout>

@code {
    private MudThemeProvider _mudThemeProvider = new MudThemeProvider();
    private bool _drawerOpen = true;
    private bool _isDarkMode = false;

    // Log the current audience and page to the console for debugging
    protected override async Task OnInitializedAsync()
    {
        if (AudienceService != null)
        {
            Console.WriteLine($"Current Audience: {AudienceService.CurrentAudience}");
            Console.WriteLine($"Current Page: {NavManager.Uri}");
        }
        else
        {
            Console.WriteLine("AudienceService is null.");
        }
        Console.WriteLine($"Current URL: {NavManager.Uri}");
        _mudThemeProvider = new MudThemeProvider();
        _isDarkMode = _mudThemeProvider.IsDarkMode;
        await base.OnInitializedAsync();
    }


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (_mudThemeProvider != null)
            {
                await _mudThemeProvider.WatchSystemPreference(OnSystemPreferenceChanged);
            }
            StateHasChanged();
        }
    }

    private Task OnSystemPreferenceChanged(bool isDarkMode)
    {
        _isDarkMode = isDarkMode;
        return Task.CompletedTask;
    }

    private void ToggleNavMenu()
    {
        _drawerOpen = !_drawerOpen;
    }

    private void ToggleDarkMode()
    {
        _isDarkMode = !_isDarkMode;
        StateHasChanged();
    }

    public MudTheme CustomTheme = new MudTheme
        {
            Typography = new Typography
            {
                Default = new Default
                {
                    FontFamily = new[] { "Lato", "sans-serif" },
                    FontWeight = 300,
                    FontSize = "1rem",
                    LineHeight = 1.5,
                    LetterSpacing = "0.00938em",
                },
                H1 = new H1
                {
                    FontFamily = new[] { "Playfair Display", "Oranienbaum", "serif" },
                    FontSize = "2.5rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "-0.01562em",
                },
                H2 = new H2
                {
                    FontFamily = new[] { "Playfair Display", "Oranienbaum", "serif" },
                    FontSize = "2rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "-0.00833em",
                },
                H3 = new H3
                {
                    FontFamily = new[] { "Playfair Display", "Oranienbaum", "serif" },
                    FontSize = "1.75rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "0em",
                },
                H4 = new H4
                {
                    FontFamily = new[] { "Oranienbaum", "serif" },
                    FontSize = "1.5rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "0.00735em",
                },
                H5 = new H5
                {
                    FontFamily = new[] { "Oranienbaum", "serif" },
                    FontSize = "1.25rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "0em",
                },
                H6 = new H6
                {
                    FontFamily = new[] { "Oranienbaum", "serif" },
                    FontSize = "1rem",
                    FontWeight = 700,
                    LineHeight = 1.2,
                    LetterSpacing = "0.00938em",
                },
                Body1 = new Body1
                {
                    FontFamily = new[] { "Lato", "sans-serif" },
                    FontSize = "0.875rem",
                    FontWeight = 400,
                    LineHeight = 1.43,
                    LetterSpacing = "0.01071em",
                },
                Body2 = new Body2
                {
                    FontFamily = new[] { "Droid Sans", "sans-serif" },
                    FontSize = "0.875rem",
                    FontWeight = 400,
                    LineHeight = 1.43,
                    LetterSpacing = "0.01071em",
                },
                Subtitle1 = new Subtitle1
                {
                    FontFamily = new[] { "Lato", "sans-serif" },
                    FontSize = "1rem",
                    FontWeight = 400,
                    LineHeight = 1.75,
                    LetterSpacing = "0.00938em",
                },
                Subtitle2 = new Subtitle2
                {
                    FontFamily = new[] { "Droid Sans", "sans-serif" },
                    FontSize = "0.875rem",
                    FontWeight = 500,
                    LineHeight = 1.57,
                    LetterSpacing = "0.00714em",
                }
            },
            PaletteLight = new PaletteLight
            {
                Primary = "#3E2723",
                Secondary = "#A1887F",
                AppbarBackground = "#6D4C41",
                Background = "#EEEEDE",
                Surface = "#F2F2F8",
                DrawerBackground = "#D7CCC8",
                DrawerText = "#3E2723",
                TextPrimary = "#3E2723",
                TextSecondary = "#5D4037",
                ActionDefault = "#3E2723",
                ActionDisabled = "#BCAAA4",
                ActionDisabledBackground = "#E0E0E0",
                Divider = "#CCCCCC",
                DividerLight = "#E0E0E0",
                TableLines = "#CCCCCC",
                LinesDefault = "#CCCCCC",
                LinesInputs = "#B0B0B0",
                TextDisabled = "#BCAAA4",
                Info = "#4A90E2",
                Success = "#50E3C2",
                Warning = "#F5A623",
                Error = "#D0021B",
                Dark = "#3E2723"
            }

        };
}
